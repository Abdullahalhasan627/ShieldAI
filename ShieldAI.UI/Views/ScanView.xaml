<UserControl x:Class="ShieldAI.UI.Views.ScanView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª" Style="{StaticResource HeaderStyle}" Margin="0,0,0,24"/>
            
            <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØ­Øµ -->
            <Border Style="{StaticResource CardStyle}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙØ­Øµ" Style="{StaticResource SubHeaderStyle}" Margin="0,0,0,16"/>
                        
                        <WrapPanel>
                            <Button Content="ðŸš€ ÙØ­Øµ Ø³Ø±ÙŠØ¹" 
                                    Style="{StaticResource ModernButtonStyle}"
                                    Command="{Binding QuickScanCommand}"
                                    IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                    Margin="0,0,12,12"/>
                            
                            <Button Content="ðŸ–¥ï¸ ÙØ­Øµ ÙƒØ§Ù…Ù„" 
                                    Style="{StaticResource SuccessButtonStyle}"
                                    Command="{Binding FullScanCommand}"
                                    IsEnabled="{Binding IsScanning, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                    Margin="0,0,12,12"/>
                            
                            <Button Content="âŒ Ø¥Ù„ØºØ§Ø¡" 
                                    Style="{StaticResource DangerButtonStyle}"
                                    Command="{Binding CancelScanCommand}"
                                    Visibility="{Binding IsScanning, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Margin="0,0,12,12"/>
                        </WrapPanel>
                        
                        <!-- ÙØ­Øµ Ù…Ø®ØµØµ -->
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBox Text="{Binding SelectedPath, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource ModernTextBoxStyle}"
                                     Width="400"
                                     Margin="0,0,12,0"/>
                            <Button Content="ðŸ“ Ø§Ø³ØªØ¹Ø±Ø§Ø¶" 
                                    Style="{StaticResource ModernButtonStyle}"
                                    Command="{Binding BrowseFolderCommand}"
                                    Margin="0,0,12,0"/>
                            <Button Content="ðŸ” ÙØ­Øµ" 
                                    Style="{StaticResource ModernButtonStyle}"
                                    Command="{Binding CustomScanCommand}"
                                    IsEnabled="{Binding SelectedPath.Length}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>
        </StackPanel>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" 
                Visibility="{Binding IsScanning, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel>
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="{Binding ScanStatusText}" 
                               Style="{StaticResource SubHeaderStyle}"/>
                    <TextBlock Grid.Column="1" Text="{Binding ScanProgress, StringFormat='{}{0}%'}" 
                               Style="{StaticResource SubHeaderStyle}"
                               Foreground="{StaticResource PrimaryBrush}"/>
                </Grid>
                
                <ProgressBar Value="{Binding ScanProgress}" 
                             Style="{StaticResource ModernProgressBarStyle}"
                             Margin="0,0,0,8"/>
                
                <TextBlock Text="{Binding CurrentScanFile}" 
                           Style="{StaticResource BodyStyle}"
                           TextTrimming="CharacterEllipsis"/>
                
                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                    <TextBlock Text="Ø§Ù„Ù…Ù„ÙØ§Øª: " Style="{StaticResource BodyStyle}"/>
                    <TextBlock Text="{Binding ScannedFilesCount}" 
                               Foreground="{StaticResource TextPrimaryBrush}"
                               FontWeight="SemiBold"/>
                    
                    <TextBlock Text="  |  Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª: " Style="{StaticResource BodyStyle}" Margin="16,0,0,0"/>
                    <TextBlock Text="{Binding ThreatsFoundCount}" 
                               Foreground="{StaticResource DangerBrush}"
                               FontWeight="SemiBold"/>
                </StackPanel>
            </StackPanel>
        </Border>
        
        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Margin="0,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" Text="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ" 
                           Style="{StaticResource SubHeaderStyle}" 
                           Margin="0,0,0,16"/>
                
                <ListView Grid.Row="1" 
                          ItemsSource="{Binding ScanResults}"
                          SelectedItem="{Binding SelectedScanResult}"
                          Style="{StaticResource ModernListViewStyle}"
                          ItemContainerStyle="{StaticResource ModernListViewItemStyle}">
                    <ListView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="ðŸ›¡ï¸ Ù†Ù‚Ù„ Ù„Ù„Ø­Ø¬Ø± Ø§Ù„ØµØ­ÙŠ" Command="{Binding QuarantineSelectedFileCommand}"/>
                            <MenuItem Header="ðŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù" Command="{Binding DeleteSelectedFileCommand}"/>
                            <Separator/>
                            <MenuItem Header="ðŸ“‚ ÙØªØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù„Ù" Command="{Binding OpenFileLocationCommand}"/>
                            <MenuItem Header="ðŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø§Ø±" Command="{Binding CopyFilePathCommand}"/>
                        </ContextMenu>
                    </ListView.ContextMenu>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Ø§Ù„Ø­Ø§Ù„Ø©" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="âœ…"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsInfected}" Value="True">
                                                            <Setter Property="Text" Value="ðŸ”´"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsSuspicious}" Value="True">
                                                            <Setter Property="Text" Value="ðŸŸ¡"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            
                            <GridViewColumn Header="Ø§Ù„Ù…Ù„Ù" Width="300" 
                                            DisplayMemberBinding="{Binding FileName}"/>
                            
                            <GridViewColumn Header="Ø§Ù„Ù…Ø³Ø§Ø±" Width="300" 
                                            DisplayMemberBinding="{Binding FilePath}"/>
                            
                            <GridViewColumn Header="Ø§Ù„Ø®Ø·ÙˆØ±Ø©" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding RiskScore, StringFormat='{}{0:P0}'}"
                                                   Foreground="{Binding RiskScore, Converter={StaticResource RiskToColorConverter}}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            
                            <GridViewColumn Header="Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯" Width="200">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Threat.Name}" 
                                                   Foreground="{StaticResource DangerBrush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </Border>
    </Grid>
</UserControl>
