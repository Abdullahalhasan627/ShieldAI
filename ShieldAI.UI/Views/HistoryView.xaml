<UserControl x:Class="ShieldAI.UI.Views.HistoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:ShieldAI.UI.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="900">
    
    <UserControl.DataContext>
        <vm:HistoryViewModel/>
    </UserControl.DataContext>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Ø³Ø¬Ù„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª" Style="{StaticResource HeaderStyle}"/>
            <TextBlock Style="{StaticResource BodyStyle}" Margin="0,8,0,0">
                <Run Text="Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ© Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„Ø£Ø³Ø¨Ø§Ø¨"/>
                <Run Text=" | "/>
                <Run Text="{Binding TotalRecords, Mode=OneWay}"/>
                <Run Text=" Ø³Ø¬Ù„"/>
            </TextBlock>
        </StackPanel>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}" Margin="0,0,0,16" Padding="16">
            <WrapPanel>
                <!-- ÙÙ„ØªØ± Ø§Ù„Ù‚Ø±Ø§Ø± -->
                <StackPanel Margin="0,0,16,0">
                    <TextBlock Text="Ø§Ù„Ù‚Ø±Ø§Ø±:" Style="{StaticResource BodyStyle}" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding VerdictFilters}"
                              SelectedItem="{Binding SelectedVerdictFilter}"
                              Width="140" Padding="8,6"/>
                </StackPanel>
                
                <!-- ÙÙ„ØªØ± Ø§Ù„Ù…Ø­Ø±Ùƒ -->
                <StackPanel Margin="0,0,16,0">
                    <TextBlock Text="Ø§Ù„Ù…Ø­Ø±Ùƒ:" Style="{StaticResource BodyStyle}" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding EngineFilters}"
                              SelectedItem="{Binding SelectedEngineFilter}"
                              Width="160" Padding="8,6"/>
                </StackPanel>
                
                <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† -->
                <StackPanel Margin="0,0,16,0">
                    <TextBlock Text="Ù…Ù†:" Style="{StaticResource BodyStyle}" Margin="0,0,0,4"/>
                    <DatePicker SelectedDate="{Binding DateFrom}" Width="140"/>
                </StackPanel>
                
                <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ -->
                <StackPanel Margin="0,0,16,0">
                    <TextBlock Text="Ø¥Ù„Ù‰:" Style="{StaticResource BodyStyle}" Margin="0,0,0,4"/>
                    <DatePicker SelectedDate="{Binding DateTo}" Width="140"/>
                </StackPanel>
                
                <!-- Ø£Ø²Ø±Ø§Ø± -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" Margin="0,0,0,0">
                    <Button Content="Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±" 
                            Command="{Binding ClearFiltersCommand}"
                            Style="{StaticResource ModernButtonStyle}"
                            Background="{StaticResource BackgroundHoverBrush}"
                            Padding="12,6" Margin="0,0,8,0"/>
                    <Button Content="ØªØ­Ø¯ÙŠØ«" 
                            Command="{Binding RefreshCommand}"
                            Style="{StaticResource ModernButtonStyle}"
                            Padding="12,6"/>
                </StackPanel>
            </WrapPanel>
        </Border>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}">
            <Grid>
                <ListView ItemsSource="{Binding FilteredRecords}"
                          SelectedItem="{Binding SelectedRecord}"
                          Style="{StaticResource ModernListViewStyle}"
                          ItemContainerStyle="{StaticResource ModernListViewItemStyle}">
                    <ListView.View>
                        <GridView>
                            <!-- Ø¯Ø±Ø¬Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© -->
                            <GridViewColumn Header="Ø§Ù„Ø®Ø·ÙˆØ±Ø©" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding RiskColor}" 
                                                CornerRadius="4" Padding="6,3"
                                                HorizontalAlignment="Center">
                                            <TextBlock Text="{Binding RiskScore, StringFormat='{}{0}/100'}" 
                                                       Foreground="White" FontWeight="Bold"
                                                       FontSize="12"/>
                                        </Border>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            
                            <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù -->
                            <GridViewColumn Header="Ø§Ù„Ù…Ù„Ù" Width="180" 
                                            DisplayMemberBinding="{Binding FileName}"/>
                            
                            <!-- Ø§Ù„Ù‚Ø±Ø§Ø± -->
                            <GridViewColumn Header="Ø§Ù„Ù‚Ø±Ø§Ø±" Width="100" 
                                            DisplayMemberBinding="{Binding Verdict}"/>
                            
                            <!-- Ø§Ù„Ù…Ø³Ø§Ø± -->
                            <GridViewColumn Header="Ø§Ù„Ù…Ø³Ø§Ø±" Width="250" 
                                            DisplayMemberBinding="{Binding FilePath}"/>
                            
                            <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
                            <GridViewColumn Header="Ø§Ù„ØªØ§Ø±ÙŠØ®" Width="140">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding DetectedAt, StringFormat='{}{0:yyyy/MM/dd HH:mm}'}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            
                            <!-- Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ -->
                            <GridViewColumn Header="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡" Width="100" 
                                            DisplayMemberBinding="{Binding Action}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
                
                <!-- Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø³Ø¬Ù„Ø§Øª -->
                <StackPanel VerticalAlignment="Center" 
                            HorizontalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <TextBlock Text="ðŸ“‹" FontSize="64" HorizontalAlignment="Center"/>
                    <TextBlock Text="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ØªÙ‡Ø¯ÙŠØ¯Ø§Øª" 
                               Style="{StaticResource SubHeaderStyle}"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0"/>
                </StackPanel>
                
                <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..." 
                               Style="{StaticResource BodyStyle}"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯ -->
        <Border Grid.Row="3" Style="{StaticResource CardStyle}" 
                Margin="0,16,0,0" Padding="16">
            <StackPanel>
                <TextBlock Text="ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯" Style="{StaticResource SubHeaderStyle}" Margin="0,0,0,8"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ -->
                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨:" FontWeight="Bold" Style="{StaticResource BodyStyle}" Margin="0,0,0,4"/>
                        <ItemsControl ItemsSource="{Binding SelectedRecord.Reasons}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Style="{StaticResource BodyStyle}" Margin="8,2,0,2">
                                        <Run Text="â€¢"/>
                                        <Run Text="{Binding Mode=OneWay}"/>
                                    </TextBlock>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                    
                    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª -->
                    <StackPanel Grid.Column="1" Margin="8,0,0,0">
                        <TextBlock Text="Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø±ÙƒØ§Øª:" FontWeight="Bold" Style="{StaticResource BodyStyle}" Margin="0,0,0,4"/>
                        <ItemsControl ItemsSource="{Binding SelectedRecord.EngineResults}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="8,2,0,2">
                                        <TextBlock Text="{Binding DisplayName}" Width="120" Style="{StaticResource BodyStyle}"/>
                                        <TextBlock Text="{Binding Score, StringFormat='Score: {0}'}" Width="80" Style="{StaticResource BodyStyle}"/>
                                        <TextBlock Text="{Binding Verdict}" Style="{StaticResource BodyStyle}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
